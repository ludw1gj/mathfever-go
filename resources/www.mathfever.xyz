server {
        listen 80;
        listen [::]:80;

        server_name www.mathfever.xyz;
        return 301 https://www.mathfever.xyz$request_uri;
}

server {
        listen 443 ssl http2;
        listen [::]:443 ssl http2;

        server_name www.mathfever.xyz;
        access_log off;

        ssl_certificate /etc/letsencrypt/live/www.mathfever.xyz/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/www.mathfever.xyz/privkey.pem;

        keepalive_timeout 650;
        keepalive_requests 10000;

        gzip on;
        gzip_min_length 500;
        gzip_proxied any;
        gzip_comp_level 1;
        gzip_types text/css text/javascript text/xml text/plain text/x-component application/javascript application/json application/xml appli$
        gzip_vary on;
        gzip_disable "msie6";

        server_tokens off;

        location /static/ {
                alias /srv/mathfever/static/;
                expires 14d;
                autoindex off;
        }

        location / {
                expires 14d;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Proto $scheme;
                proxy_set_header Host $http_host;
                proxy_set_header X-NginX-Proxy true;
                proxy_read_timeout 5m;
                proxy_connect_timeout 5m;

                proxy_cache_key sfs$request_uri$scheme;
                proxy_pass http://127.0.0.1:8000;
                proxy_redirect off;
    }
}
